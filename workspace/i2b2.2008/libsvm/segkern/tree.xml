<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">
	<!-- define node info for mapping queries -->
	<bean name="nodeInstanceInfo" class="ytex.kernel.tree.NodeMappingInfo">
		<property name="nodeType" value="instance" />
		<property name="values">
			<list>
				<value>instance_id</value>
			</list>
		</property>
	</bean>
	<bean name="nodeSegmentInfo" class="ytex.kernel.tree.NodeMappingInfo">
		<property name="nodeType" value="segment" />
		<property name="values">
			<list>
				<value>anno_base_id</value>
				<value>segment_id</value>
			</list>
		</property>
	</bean>
	<bean name="nodeConceptInfo" class="ytex.kernel.tree.NodeMappingInfo">
		<property name="nodeType" value="ontology_concept" />
		<property name="values">
			<list>
				<value>code</value>
			</list>
		</property>
	</bean>
	<bean name="nodeWordInfo" class="ytex.kernel.tree.NodeMappingInfo">
		<property name="nodeType" value="word" />
		<property name="values">
			<list>
				<value>canonical_form</value>
			</list>
		</property>
	</bean>
	<!-- First query instantiates instances down to named entities 2nd query 
		adds word nodes to document nodes. -->
	<bean name="treeMappingInfo" class="ytex.kernel.tree.TreeMappingInfo">
		<property name="instanceIDField" value="instance_id" />
		<property name="instanceQueryMappingInfo">
			<bean class="ytex.kernel.tree.QueryMappingInfo">
				<!--  load instance and segments -->
				<property name="query">
					<value><![CDATA[
select distinct hs.instance_id, seg.anno_base_id, seg.segment_id
from hotspot_sentence hs
inner join anno_contain c on c.child_anno_base_id = hs.anno_base_id and c.parent_uima_type_id = 12
inner join anno_segment seg on seg.anno_base_id = c.parent_anno_base_id
inner join i2b2_2008_disease ds on ds.disease = hs.label
where ds.disease_id = 14
and evaluation > 0.07
order by hs.instance_id
					]]></value>
				</property>
				<property name="nodeTypes">
					<list>
						<ref bean="nodeInstanceInfo" />
						<ref bean="nodeSegmentInfo" />
					</list>
				</property>
			</bean>
		</property>
		<property name="nodeQueryMappingInfos">
			<list>
				<bean class="ytex.kernel.tree.QueryMappingInfo">
				<!-- load segments and concepts -->
					<property name="query">
						<value><![CDATA[
select distinct seg.anno_base_id, seg.segment_id, c.code
from hotspot_sentence hs
/* convert disease into id */
inner join i2b2_2008_disease ds on ds.disease = hs.label
/* get segment */
inner join anno_contain sc on sc.child_anno_base_id = hs.anno_base_id and sc.parent_uima_type_id = 12
inner join anno_segment seg on seg.anno_base_id = sc.parent_anno_base_id
/* get named entities */
inner join anno_contain ac on ac.parent_anno_base_id = hs.anno_base_id and ac.child_uima_type_id = 8
inner join anno_named_entity ne on ne.anno_base_id = ac.child_anno_base_id
/* get ontology concepts */
inner join ytex.anno_ontology_concept c on c.anno_base_id = ne.anno_base_id
/* exclude named entities within other named entities */
left join anno_contain acn on acn.child_anno_base_id = ac.child_anno_base_id and acn.parent_uima_type_id = 8
where ds.disease_id = 14
and acn.parent_anno_base_id is null
and evaluation > 0.07
order by seg.anno_base_id, seg.segment_id
						]]></value>
					</property>
					<property name="nodeTypes">
						<list>
							<ref bean="nodeSegmentInfo" />
							<ref bean="nodeConceptInfo" />
						</list>
					</property>
				</bean>
				<!-- load segments and words -->
				<bean class="ytex.kernel.tree.QueryMappingInfo">
					<property name="query">
						<!-- words -->
						<value><![CDATA[
select distinct seg.anno_base_id, seg.segment_id, w.canonical_form
from hotspot_sentence hs
/* convert disease into id */
inner join i2b2_2008_disease ds on ds.disease = hs.label
/* get segment */
inner join anno_contain sc on sc.child_anno_base_id = hs.anno_base_id and sc.parent_uima_type_id = 12
inner join anno_segment seg on seg.anno_base_id = sc.parent_anno_base_id
/* get words */
inner join anno_contain ac on ac.parent_anno_base_id = hs.anno_base_id and ac.child_uima_type_id = 25
inner join anno_word_token w on w.anno_base_id = ac.child_anno_base_id and w.canonical_form is not null
/* exclude words are not in named entities */
left join anno_contain acw on acw.child_anno_base_id = ac.child_anno_base_id and acw.parent_uima_type_id = 8
where acw.parent_anno_base_id is null
and ds.disease_id = 14
and evaluation > 0.07
and canonical_form not in (select stopword from stopword)
order by seg.anno_base_id, seg.segment_id 
					]]></value>
					</property>
					<property name="nodeTypes">
						<list>
							<ref bean="nodeSegmentInfo" />
							<ref bean="nodeWordInfo" />
						</list>
					</property>
				</bean>
			</list>
		</property>
	</bean>
</beans>